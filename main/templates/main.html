{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Cihuy United - Products & News</title>
{% endblock meta %}

{% block content %}
{% include 'navbar.html' %}

<div class="bg-[#181f2a] min-h-screen py-10">
  <div class="max-w-[1100px] mx-auto px-4">

    <!-- Header -->
    <header class="mb-8 text-center sm:text-left">
      <h1 class="text-3xl font-bold text-[#90caf9]">Cihuy United</h1>
      <p class="text-[#b0bec5]">Stay updated with the latest football stories and analysis</p>
    </header>

    <!-- Filter -->
    <section class="flex flex-wrap items-center justify-between mb-8 bg-[#232b3e] rounded-xl border border-[#374151] p-5">
      <div class="flex gap-3">
        <a href="?"
           class="px-5 py-2 rounded-md font-medium transition 
           {% if request.GET.filter == 'all' or not request.GET.filter %}
              bg-[#43a047] text-white
           {% else %}
              bg-[#1a2233] text-[#b0bec5] border border-[#374151]
           {% endif %}">
          All Products
        </a>
        <a href="?filter=my"
           class="px-5 py-2 rounded-md font-medium transition
           {% if request.GET.filter == 'my' %}
              bg-[#43a047] text-white
           {% else %}
              bg-[#1a2233] text-[#b0bec5] border border-[#374151]
           {% endif %}">
          My Products
        </a>
      </div>

      {% if user.is_authenticated %}
      <div class="text-[#b0bec5] text-sm mt-3 sm:mt-0">
        Last login: {{ last_login }}
      </div>
      {% endif %}
    </section>

    <!-- Products -->
    <section class="bg-[#232b3e] rounded-2xl p-8 shadow-lg mb-12">
      <!-- Info Aplikasi -->
      <div class="mb-6 text-[#b0bec5] space-x-6">
        <span>Nama Aplikasi: <b class="text-white">{{ nama_aplikasi }}</b></span>
        <span>NPM: <b class="text-white">{{ npm }}</b></span>
        <span>Name: <b class="text-white">{{ name }}</b></span>
        <span>Class: <b class="text-white">{{ class }}</b></span>
      </div>

      <hr class="border-t border-[#374151] my-6">

      <div class="flex justify-between items-center mb-5">
        <h2 class="text-2xl text-[#90caf9] font-semibold">Products</h2>
        <a href="{% url 'main:create_product' %}">
          <button class="bg-[#1976d2] hover:bg-[#1565c0] text-white px-5 py-2 rounded-md font-semibold transition">
            + Add Product
          </button>
        </a>
      </div>

      {% if not products %}
      <!-- Empty State -->
      <div class="bg-[#1a2233] rounded-xl p-10 text-center text-[#b0bec5]">
        <img src="{% static 'image/no-news.png' %}" alt="No products" class="w-28 mx-auto mb-4">
        <h3 class="text-white text-xl mb-2">No products found</h3>
        <p class="mb-4">Be the first to add a product to Cihuy United.</p>
        <a href="{% url 'main:create_product' %}">
          <button class="bg-[#43a047] hover:bg-[#388e3c] text-white px-5 py-2 rounded-md font-semibold transition">
            Create Product
          </button>
        </a>
      </div>
      {% else %}
      <!-- Products Grid -->
      <div class="grid gap-6 grid-cols-[repeat(auto-fit,minmax(270px,1fr))]">
        {% for product in products %}
        <div class="bg-[#1a2233] rounded-xl p-5 shadow-md flex flex-col">
          <a href="{% url 'main:show_product' product.id %}" class="no-underline">
            <h3 class="text-white text-lg font-semibold mb-2 hover:text-[#90caf9] transition">
              {{ product.name }}
            </h3>
          </a>

          <p class="mb-3 text-sm flex items-center flex-wrap gap-2 text-[#b0bec5]">
            <span class="bg-[#374151] text-[#90caf9] px-2 py-0.5 rounded-md">{{ product.category }}</span>
            {% if product.is_featured %}
              <span class="bg-[#ffe082] text-[#d17b00] px-2 py-0.5 rounded-md">★ Featured</span>
            {% endif %}

            <span class="text-xs text-[#90caf9] italic">
              {{ product.created_at|date:"d M Y H:i" }}
            </span>

            <!-- Views badge -->
            <span class="bg-[#1a2233] border border-[#374151] text-[#b0bec5] px-2 py-0.5 rounded-md flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-[#90caf9]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 
                  7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
              {{ product.views }}
            </span>
          </p>

          {% if product.thumbnail %}
          <img src="{{ product.thumbnail }}" alt="thumbnail" class="rounded-md w-full h-[160px] object-cover mb-3">
          {% endif %}

          <div class="text-[#90caf9] font-bold text-lg mb-1">Rp {{ product.price|floatformat:0 }}</div>
          <div class="text-[#b0bec5] text-sm mb-3">Stock: {{ product.stock }}</div>

          <p class="text-[#b0bec5] text-sm flex-grow">{{ product.description|truncatewords:25 }}...</p>

          <div class="mt-4 flex flex-wrap gap-2">
            <a href="{% url 'main:show_product' product.id %}">
              <button class="bg-[#1976d2] hover:bg-[#1565c0] text-white px-4 py-1.5 rounded-md font-medium transition">
                Read More
              </button>
            </a>

            {% if user.is_authenticated and product.user == user %}
            <a href="{% url 'main:edit_product' product.pk %}">
              <button class="bg-[#43a047] hover:bg-[#388e3c] text-white px-4 py-1.5 rounded-md font-medium transition">
                Edit
              </button>
            </a>
            <a href="{% url 'main:delete_product' product.pk %}" onclick="return confirm('Are you sure you want to delete this product?');">
              <button class="bg-[#e53935] hover:bg-[#c62828] text-white px-4 py-1.5 rounded-md font-medium transition">
                Delete
              </button>
            </a>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </section>

    <!-- Optional More Products -->
    {% if products_list is defined %}
    <section class="bg-[#232b3e] rounded-2xl p-8 shadow-lg mb-12">
      <div class="flex justify-between items-center mb-5">
        <h2 class="text-2xl text-[#90caf9] font-semibold">More Products</h2>
        <a href="{% url 'main:create_product' %}">
          <button class="bg-[#43a047] hover:bg-[#388e3c] text-white px-5 py-2 rounded-md font-semibold transition">
            + Create Product
          </button>
        </a>
      </div>
      {% if not products_list %}
      <div class="bg-[#1a2233] rounded-xl p-10 text-center text-[#b0bec5]">
        <img src="{% static 'image/no-news.png' %}" alt="No products" class="w-28 mx-auto mb-4">
        <h3 class="text-white text-xl mb-2">No products found</h3>
        <p class="mb-4">Be the first to share a product with the community.</p>
        <a href="{% url 'main:create_product' %}">
          <button class="bg-[#43a047] hover:bg-[#388e3c] text-white px-5 py-2 rounded-md font-semibold transition">
            Create Product
          </button>
        </a>
      </div>
      {% else %}
      <div class="grid gap-6 grid-cols-[repeat(auto-fit,minmax(270px,1fr))]">
        {% for product in products_list %}
          {% include 'card_product.html' with product=product %}
        {% endfor %}
      </div>
      {% endif %}
    </section>
    {% endif %}

    <p class="text-center text-[#789] mt-10">© 2025 Cihuy United</p>

  </div>
</div>
{% endblock content %}
